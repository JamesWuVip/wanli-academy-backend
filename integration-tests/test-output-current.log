🚀 万里书院集成测试开始
==================================================
测试目标: http://localhost:8080
超时时间: 30000ms
报告目录: integration-tests/reports
==================================================

🧪 开始测试套件: 健康检查测试
   验证应用基本可用性和健康状态
   ✅ 应用健康检查: 应用状态正常
   ✅ Swagger UI可访问性: Swagger UI正常访问
   ✅ API文档可访问性: API文档正常访问
   📊 套件结果: 3通过, 0失败, 0跳过

🧪 开始测试套件: 认证测试
   验证用户登录、权限控制和JWT令牌
🔍 登录请求数据: {"usernameOrEmail":"test_admin","password":"password123"}
🔍 登录响应状态: 200
🔍 登录响应数据: {"data":{"accessToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0FETUlOIl0sInN1YiI6InRlc3RfYWRtaW4iLCJpYXQiOjE3NTU0Mjg4NjQsImV4cCI6MTc1NTUxNTI2NH0.njapOLvfiZhEVCcf9vrYCja4ccUBGWHbaryiGly4Pik","refreshToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0FETUlOIl0sInN1YiI6InRlc3RfYWRtaW4iLCJpYXQiOjE3NTU0Mjg4NjQsImV4cCI6MTc1NjAzMzY2NH0.teVIq2eFlx9eyu05GRPVXjujZgZWgodUP96IcHfsYqc","tokenType":"Bearer","expiresIn":86400000,"refreshExpiresIn":604800000,"userId":13,"username":"test_admin","email":"admin@test.wanli.com","roles":["ROLE_ADMIN"],"lastLoginAt":"2025-08-17T19:07:44.76381"},"success":true,"message":"登录成功","timestamp":"2025-08-17T19:07:44.766156"}
   ✅ 管理员登录: 管理员登录成功
🔍 登录请求数据: {"usernameOrEmail":"invalid","password":"invalid"}
🔍 登录响应状态: 401
🔍 登录响应数据: {"success":false,"message":"用户名或密码错误","timestamp":"2025-08-17T19:07:45.078609"}
   ✅ 无效登录拒绝: 无效登录被正确拒绝
🔍 登录请求数据: {"usernameOrEmail":"test_hq_teacher","password":"password123"}
🔍 登录响应状态: 200
🔍 登录响应数据: {"data":{"accessToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0hRX1RFQUNIRVIiXSwic3ViIjoidGVzdF9ocV90ZWFjaGVyIiwiaWF0IjoxNzU1NDI4ODY1LCJleHAiOjE3NTU1MTUyNjV9.QgvPJ9O7wHB4aM4_k00X6XhFgUqb0952Rn3cwgWznFg","refreshToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0hRX1RFQUNIRVIiXSwic3ViIjoidGVzdF9ocV90ZWFjaGVyIiwiaWF0IjoxNzU1NDI4ODY1LCJleHAiOjE3NTYwMzM2NjV9.QInBJWvb0TMgcJ_BmbZe2XWzlgwfreHzzDAfg30FoJ0","tokenType":"Bearer","expiresIn":86400000,"refreshExpiresIn":604800000,"userId":14,"username":"test_hq_teacher","email":"hq.teacher@test.wanli.com","roles":["ROLE_HQ_TEACHER"],"lastLoginAt":"2025-08-17T19:07:45.411791"},"success":true,"message":"登录成功","timestamp":"2025-08-17T19:07:45.412756"}
   ✅ 总部教师登录: 总部教师登录成功
   📊 套件结果: 3通过, 0失败, 0跳过

🧪 开始测试套件: 作业管理测试
   验证作业CRUD操作和权限控制
🔍 登录请求数据: {"usernameOrEmail":"test_hq_teacher","password":"password123"}
🔍 登录响应状态: 200
🔍 登录响应数据: {"data":{"accessToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0hRX1RFQUNIRVIiXSwic3ViIjoidGVzdF9ocV90ZWFjaGVyIiwiaWF0IjoxNzU1NDI4ODY1LCJleHAiOjE3NTU1MTUyNjV9.QgvPJ9O7wHB4aM4_k00X6XhFgUqb0952Rn3cwgWznFg","refreshToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0hRX1RFQUNIRVIiXSwic3ViIjoidGVzdF9ocV90ZWFjaGVyIiwiaWF0IjoxNzU1NDI4ODY1LCJleHAiOjE3NTYwMzM2NjV9.QInBJWvb0TMgcJ_BmbZe2XWzlgwfreHzzDAfg30FoJ0","tokenType":"Bearer","expiresIn":86400000,"refreshExpiresIn":604800000,"userId":14,"username":"test_hq_teacher","email":"hq.teacher@test.wanli.com","roles":["ROLE_HQ_TEACHER"],"lastLoginAt":"2025-08-17T19:07:45.794767"},"success":true,"message":"登录成功","timestamp":"2025-08-17T19:07:45.79601"}
   ✅ 创建作业: 作业创建成功，ID: a3879865-84fd-4776-8833-1664aeb6b757
   ✅ 获取作业列表: 获取到13个作业
   ❌ 添加题目: 题目添加失败
      错误: 状态码: 400, 响应: {"code":"RUNTIME_ERROR","message":"Could not commit JPA transaction","timestamp":1755428866779}
🔍 登录请求数据: {"usernameOrEmail":"test_student1","password":"password123"}
🔍 登录响应状态: 200
🔍 登录响应数据: {"data":{"accessToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX1NUVURFTlQiXSwic3ViIjoidGVzdF9zdHVkZW50MSIsImlhdCI6MTc1NTQyODg2NywiZXhwIjoxNzU1NTE1MjY3fQ.7Z5QRfeNdcW7hUYanB9rFjpkoEYjnby5Y4puJe0o6JA","refreshToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX1NUVURFTlQiXSwic3ViIjoidGVzdF9zdHVkZW50MSIsImlhdCI6MTc1NTQyODg2NywiZXhwIjoxNzU2MDMzNjY3fQ.7WKty0XtMm71xmKEC6pHguhmLBx-e_WHh9Sb8_Yp5rs","tokenType":"Bearer","expiresIn":86400000,"refreshExpiresIn":604800000,"userId":16,"username":"test_student1","email":"student1@test.wanli.com","roles":["ROLE_STUDENT"],"lastLoginAt":"2025-08-17T19:07:47.198198"},"success":true,"message":"登录成功","timestamp":"2025-08-17T19:07:47.199241"}
   ✅ 学生权限控制: 学生创建作业被正确拒绝
   📊 套件结果: 3通过, 1失败, 0跳过

🧪 开始测试套件: 用户管理测试
   验证用户信息获取和管理功能
🔍 登录请求数据: {"usernameOrEmail":"test_admin","password":"password123"}
🔍 登录响应状态: 200
🔍 登录响应数据: {"data":{"accessToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0FETUlOIl0sInN1YiI6InRlc3RfYWRtaW4iLCJpYXQiOjE3NTU0Mjg4NjcsImV4cCI6MTc1NTUxNTI2N30.ZSVGOglOfl5Lo33YITwIsK9n5io_fIZ3mRa-GNoZArA","refreshToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0FETUlOIl0sInN1YiI6InRlc3RfYWRtaW4iLCJpYXQiOjE3NTU0Mjg4NjcsImV4cCI6MTc1NjAzMzY2N30.Xkcqa-TxhEL_bfzAp3S74pnz_ofY0cQg0gPj_cJ7Pmc","tokenType":"Bearer","expiresIn":86400000,"refreshExpiresIn":604800000,"userId":13,"username":"test_admin","email":"admin@test.wanli.com","roles":["ROLE_ADMIN"],"lastLoginAt":"2025-08-17T19:07:47.619083"},"success":true,"message":"登录成功","timestamp":"2025-08-17T19:07:47.626589"}
   ✅ 获取用户列表: 获取到6个用户
   ❌ 获取当前用户信息: 获取当前用户信息失败
      错误: 状态码: 500
   📊 套件结果: 1通过, 1失败, 0跳过

🧪 开始测试套件: 性能测试
   验证API响应时间和并发处理能力
🔍 登录请求数据: {"usernameOrEmail":"test_admin","password":"password123"}
🔍 登录响应状态: 200
🔍 登录响应数据: {"data":{"accessToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0FETUlOIl0sInN1YiI6InRlc3RfYWRtaW4iLCJpYXQiOjE3NTU0Mjg4NjgsImV4cCI6MTc1NTUxNTI2OH0.kQ6IhI5j9SX2FpS0-gASqACZZllM3gUdLZBhKbtLzl8","refreshToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0FETUlOIl0sInN1YiI6InRlc3RfYWRtaW4iLCJpYXQiOjE3NTU0Mjg4NjgsImV4cCI6MTc1NjAzMzY2OH0.EeoUBPkC2A_XVhUlDnl0AuDiUiXmXz9qlHIUUSqdYaE","tokenType":"Bearer","expiresIn":86400000,"refreshExpiresIn":604800000,"userId":13,"username":"test_admin","email":"admin@test.wanli.com","roles":["ROLE_ADMIN"],"lastLoginAt":"2025-08-17T19:07:48.055203"},"success":true,"message":"登录成功","timestamp":"2025-08-17T19:07:48.055842"}
   ✅ 健康检查响应时间: 响应时间: 21ms (阈值: 100ms)
   ✅ 用户列表响应时间: 响应时间: 22ms (阈值: 500ms)
   ❌ 作业列表响应时间: 请求失败，状态码: 403
   ✅ 并发请求处理: 10个并发请求全部成功，总耗时: 50ms
   📊 套件结果: 3通过, 1失败, 0跳过

🧪 开始测试套件: 安全测试
   验证认证、授权和安全防护
   ✅ 未认证访问拒绝: 未认证访问被正确拒绝
   ✅ SQL注入防护: SQL注入尝试被阻止
🔍 登录请求数据: {"usernameOrEmail":"test_hq_teacher","password":"password123"}
🔍 登录响应状态: 200
🔍 登录响应数据: {"data":{"accessToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0hRX1RFQUNIRVIiXSwic3ViIjoidGVzdF9ocV90ZWFjaGVyIiwiaWF0IjoxNzU1NDI4ODY4LCJleHAiOjE3NTU1MTUyNjh9.sddZVYKopuFJFxjttrvK_rKqPLzRX0OC9LOl06bDyKQ","refreshToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0hRX1RFQUNIRVIiXSwic3ViIjoidGVzdF9ocV90ZWFjaGVyIiwiaWF0IjoxNzU1NDI4ODY4LCJleHAiOjE3NTYwMzM2Njh9.7lnzVKhyPTfSDfSrjooIW8fx3utcl2AFlhSxfx3gUg0","tokenType":"Bearer","expiresIn":86400000,"refreshExpiresIn":604800000,"userId":14,"username":"test_hq_teacher","email":"hq.teacher@test.wanli.com","roles":["ROLE_HQ_TEACHER"],"lastLoginAt":"2025-08-17T19:07:48.453901"},"success":true,"message":"登录成功","timestamp":"2025-08-17T19:07:48.460461"}
   ✅ XSS防护: XSS内容被正确处理
   📊 套件结果: 3通过, 0失败, 0跳过

==================================================
📊 测试结果摘要
==================================================
总测试数: 19
通过测试: 16
失败测试: 3
跳过测试: 0
成功率: 84%
执行时间: 6917ms
JSON报告: integration-tests/reports/integration-test-results.json

❌ 集成测试失败
