🚀 万里书院集成测试开始
==================================================
测试目标: http://localhost:8080
超时时间: 300ms
报告目录: integration-tests/reports
==================================================

🧪 开始测试套件: 健康检查测试
   验证应用基本可用性和健康状态
   ✅ 应用健康检查: 应用状态正常
   ✅ Swagger UI可访问性: Swagger UI正常访问
   ❌ API文档可访问性: API文档无法访问
      错误: 状态码: 0
   📊 套件结果: 2通过, 1失败, 0跳过

🧪 开始测试套件: 认证测试
   验证用户登录、权限控制和JWT令牌
🔍 登录请求数据: {"usernameOrEmail":"test_admin","password":"password123"}
🔍 登录响应状态: 0
🔍 登录响应数据: null
   ❌ 管理员登录: 管理员登录失败
🔍 登录请求数据: {"usernameOrEmail":"invalid","password":"invalid"}
🔍 登录响应状态: 401
🔍 登录响应数据: {"success":false,"message":"用户名或密码错误","timestamp":"2025-08-17T19:29:38.489208"}
   ✅ 无效登录拒绝: 无效登录被正确拒绝
🔍 登录请求数据: {"usernameOrEmail":"test_hq_teacher","password":"password123"}
🔍 登录响应状态: 200
🔍 登录响应数据: {"data":{"accessToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0hRX1RFQUNIRVIiXSwic3ViIjoidGVzdF9ocV90ZWFjaGVyIiwiaWF0IjoxNzU1NDMwMTc4LCJleHAiOjE3NTU1MTY1Nzh9.ooDoCgjiOuCxlk_HiKnBBGIe-Y8oNPaQJu6JJjOA6DI","refreshToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0hRX1RFQUNIRVIiXSwic3ViIjoidGVzdF9ocV90ZWFjaGVyIiwiaWF0IjoxNzU1NDMwMTc4LCJleHAiOjE3NTYwMzQ5Nzh9.ejvAdHcUQjrjCBts67xY5lPYaeJLyGNTT9snlQTn3g0","tokenType":"Bearer","expiresIn":86400000,"refreshExpiresIn":604800000,"userId":14,"username":"test_hq_teacher","email":"hq.teacher@test.wanli.com","roles":["ROLE_HQ_TEACHER"],"lastLoginAt":"2025-08-17T19:29:38.573549"},"success":true,"message":"登录成功","timestamp":"2025-08-17T19:29:38.574376"}
   ✅ 总部教师登录: 总部教师登录成功
   📊 套件结果: 2通过, 1失败, 0跳过

🧪 开始测试套件: 作业管理测试
   验证作业CRUD操作和权限控制
🔍 登录请求数据: {"usernameOrEmail":"test_hq_teacher","password":"password123"}
🔍 登录响应状态: 200
🔍 登录响应数据: {"data":{"accessToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0hRX1RFQUNIRVIiXSwic3ViIjoidGVzdF9ocV90ZWFjaGVyIiwiaWF0IjoxNzU1NDMwMTc4LCJleHAiOjE3NTU1MTY1Nzh9.ooDoCgjiOuCxlk_HiKnBBGIe-Y8oNPaQJu6JJjOA6DI","refreshToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0hRX1RFQUNIRVIiXSwic3ViIjoidGVzdF9ocV90ZWFjaGVyIiwiaWF0IjoxNzU1NDMwMTc4LCJleHAiOjE3NTYwMzQ5Nzh9.ejvAdHcUQjrjCBts67xY5lPYaeJLyGNTT9snlQTn3g0","tokenType":"Bearer","expiresIn":86400000,"refreshExpiresIn":604800000,"userId":14,"username":"test_hq_teacher","email":"hq.teacher@test.wanli.com","roles":["ROLE_HQ_TEACHER"],"lastLoginAt":"2025-08-17T19:29:38.675499"},"success":true,"message":"登录成功","timestamp":"2025-08-17T19:29:38.676274"}
   ✅ 创建作业: 作业创建成功，ID: 687e16b7-5369-4a69-92f5-23f55186cb04
   ✅ 获取作业列表: 获取到19个作业
   ❌ 添加题目: 题目添加失败
      错误: 状态码: 400, 响应: {"code":"RUNTIME_ERROR","message":"Could not commit JPA transaction","timestamp":1755430178760}
🔍 登录请求数据: {"usernameOrEmail":"test_student1","password":"password123"}
🔍 登录响应状态: 200
🔍 登录响应数据: {"data":{"accessToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX1NUVURFTlQiXSwic3ViIjoidGVzdF9zdHVkZW50MSIsImlhdCI6MTc1NTQzMDE3OCwiZXhwIjoxNzU1NTE2NTc4fQ.QGrqzxdsZDg1pHNNjEgH2NHhyHt7ooYyOkWFvUsu35A","refreshToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX1NUVURFTlQiXSwic3ViIjoidGVzdF9zdHVkZW50MSIsImlhdCI6MTc1NTQzMDE3OCwiZXhwIjoxNzU2MDM0OTc4fQ.IFHcpMV_AyAM1ktEfmW8X7szt6urxW3-D7n-LZb543k","tokenType":"Bearer","expiresIn":86400000,"refreshExpiresIn":604800000,"userId":16,"username":"test_student1","email":"student1@test.wanli.com","roles":["ROLE_STUDENT"],"lastLoginAt":"2025-08-17T19:29:38.846706"},"success":true,"message":"登录成功","timestamp":"2025-08-17T19:29:38.84724"}
   ✅ 学生权限控制: 学生创建作业被正确拒绝
   📊 套件结果: 3通过, 1失败, 0跳过

🧪 开始测试套件: 用户管理测试
   验证用户信息获取和管理功能
🔍 登录请求数据: {"usernameOrEmail":"test_hq_teacher","password":"password123"}
🔍 登录响应状态: 200
🔍 登录响应数据: {"data":{"accessToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0hRX1RFQUNIRVIiXSwic3ViIjoidGVzdF9ocV90ZWFjaGVyIiwiaWF0IjoxNzU1NDMwMTc4LCJleHAiOjE3NTU1MTY1Nzh9.ooDoCgjiOuCxlk_HiKnBBGIe-Y8oNPaQJu6JJjOA6DI","refreshToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0hRX1RFQUNIRVIiXSwic3ViIjoidGVzdF9ocV90ZWFjaGVyIiwiaWF0IjoxNzU1NDMwMTc4LCJleHAiOjE3NTYwMzQ5Nzh9.ejvAdHcUQjrjCBts67xY5lPYaeJLyGNTT9snlQTn3g0","tokenType":"Bearer","expiresIn":86400000,"refreshExpiresIn":604800000,"userId":14,"username":"test_hq_teacher","email":"hq.teacher@test.wanli.com","roles":["ROLE_HQ_TEACHER"],"lastLoginAt":"2025-08-17T19:29:38.943454"},"success":true,"message":"登录成功","timestamp":"2025-08-17T19:29:38.943941"}
   ❌ 获取用户列表: 获取用户列表失败
      错误: 状态码: 401
   ✅ 获取当前用户信息: 用户: test_hq_teacher
   📊 套件结果: 1通过, 1失败, 0跳过

🧪 开始测试套件: 性能测试
   验证API响应时间和并发处理能力
🔍 登录请求数据: {"usernameOrEmail":"test_hq_teacher","password":"password123"}
🔍 登录响应状态: 200
🔍 登录响应数据: {"data":{"accessToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0hRX1RFQUNIRVIiXSwic3ViIjoidGVzdF9ocV90ZWFjaGVyIiwiaWF0IjoxNzU1NDMwMTc5LCJleHAiOjE3NTU1MTY1Nzl9.Ff8iyJXaqJJaJRpZ6AN_QZt5StGW0F2G7gYKbL3mPCI","refreshToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0hRX1RFQUNIRVIiXSwic3ViIjoidGVzdF9ocV90ZWFjaGVyIiwiaWF0IjoxNzU1NDMwMTc5LCJleHAiOjE3NTYwMzQ5Nzl9.DMGboX8Z_abMk2VNpQlmLve4gwJJf9wjEjhf6N_0rr8","tokenType":"Bearer","expiresIn":86400000,"refreshExpiresIn":604800000,"userId":14,"username":"test_hq_teacher","email":"hq.teacher@test.wanli.com","roles":["ROLE_HQ_TEACHER"],"lastLoginAt":"2025-08-17T19:29:39.042058"},"success":true,"message":"登录成功","timestamp":"2025-08-17T19:29:39.042949"}
   ✅ 健康检查响应时间: 响应时间: 5ms (阈值: 100ms)
   ❌ 用户列表响应时间: 请求失败，状态码: 401
   ✅ 作业列表响应时间: 响应时间: 15ms (阈值: 500ms)
   ✅ 并发请求处理: 10个并发请求全部成功，总耗时: 17ms
   📊 套件结果: 3通过, 1失败, 0跳过

🧪 开始测试套件: 安全测试
   验证认证、授权和安全防护
   ✅ 未认证访问拒绝: 未认证访问被正确拒绝
   ✅ SQL注入防护: SQL注入尝试被阻止
🔍 登录请求数据: {"usernameOrEmail":"test_hq_teacher","password":"password123"}
🔍 登录响应状态: 200
🔍 登录响应数据: {"data":{"accessToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0hRX1RFQUNIRVIiXSwic3ViIjoidGVzdF9ocV90ZWFjaGVyIiwiaWF0IjoxNzU1NDMwMTc5LCJleHAiOjE3NTU1MTY1Nzl9.Ff8iyJXaqJJaJRpZ6AN_QZt5StGW0F2G7gYKbL3mPCI","refreshToken":"eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJST0xFX0hRX1RFQUNIRVIiXSwic3ViIjoidGVzdF9ocV90ZWFjaGVyIiwiaWF0IjoxNzU1NDMwMTc5LCJleHAiOjE3NTYwMzQ5Nzl9.DMGboX8Z_abMk2VNpQlmLve4gwJJf9wjEjhf6N_0rr8","tokenType":"Bearer","expiresIn":86400000,"refreshExpiresIn":604800000,"userId":14,"username":"test_hq_teacher","email":"hq.teacher@test.wanli.com","roles":["ROLE_HQ_TEACHER"],"lastLoginAt":"2025-08-17T19:29:39.169193"},"success":true,"message":"登录成功","timestamp":"2025-08-17T19:29:39.1698"}
   ✅ XSS防护: XSS内容被正确处理
   📊 套件结果: 3通过, 0失败, 0跳过

==================================================
📊 测试结果摘要
==================================================
总测试数: 19
通过测试: 14
失败测试: 5
跳过测试: 0
成功率: 74%
执行时间: 1419ms
JSON报告: integration-tests/reports/integration-test-results.json

❌ 集成测试失败
